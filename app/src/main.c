//#include <https_client.h>
#include <http_client.h>
#include <parse_json.h>
#include <rtc.h>
#include <routes.h>

#include <stdlib.h>
#include <stdio.h>
#include <inttypes.h>

#include <zephyr/kernel.h>
#include <zephyr/drivers/counter.h>
#include <zephyr/logging/log.h>

#include <modem/lte_lc.h>

LOG_MODULE_REGISTER(main, LOG_LEVEL_DBG);

//#define MY_I2C "I2C_1"
//const struct device *i2c_dev;

// JSON test string
// char json[] = "[{\"LastUpdated\":\"/Date(1671482373340-0500)/\",\"RouteDirections\":[{\"Departures\":[],\"Direction\":\"Northbound\",\"DirectionCode\":\"N\",\"HeadwayDepartures\":null,\"IsDone\":false,\"IsHeadway\":false,\"IsHeadwayMonitored\":false,\"RouteId\":10029,\"RouteRecordId\":2101},{\"Departures\":[{\"ADT\":null,\"ADTLocalTime\":null,\"ATA\":null,\"ATALocalTime\":null,\"Bay\":null,\"Dev\":\"00:00:00\",\"EDT\":\"/Date(1671487200000-0500)/\",\"EDTLocalTime\":\"2022-12-19T17:00:00\",\"ETA\":\"/Date(1671487080000-0500)/\",\"ETALocalTime\":\"2022-12-19T16:58:00\",\"IsCompleted\":false,\"IsLastStopOnTrip\":false,\"LastUpdated\":\"/Date(1671482268333-0500)/\",\"LastUpdatedLocalTime\":\"2022-12-19T15:37:48\",\"Mode\":0,\"ModeReportLabel\":\"Normal\",\"PropogationStatus\":0,\"SDT\":\"/Date(1671487200000-0500)/\",\"SDTLocalTime\":\"2022-12-19T17:00:00\",\"STA\":\"/Date(1671487080000-0500)/\",\"STALocalTime\":\"2022-12-19T16:58:00\",\"StopFlag\":0,\"StopStatus\":0,\"StopStatusReportLabel\":\"Scheduled\",\"Trip\":{\"BlockFareboxId\":86,\"GtfsTripId\":\"t6A4-b56-sl4C\",\"InternalSignDesc\":\"Springfield via Holyoke\",\"InternetServiceDesc\":\"Springfield via Holyoke\",\"IVRServiceDesc\":\"Springfield via Holyoke\",\"StopSequence\":0,\"TripDirection\":\"S\",\"TripId\":1700,\"TripRecordId\":370106,\"TripStartTime\":\"/Date(-2208909600000-0500)/\",\"TripStartTimeLocalTime\":\"1900-01-01T17:00:00\",\"TripStatus\":0,\"TripStatusReportLabel\":\"Scheduled\"},\"PropertyName\":\"SATCO\"},{\"ADT\":null,\"ADTLocalTime\":null,\"ATA\":null,\"ATALocalTime\":null,\"Bay\":null,\"Dev\":\"00:00:00\",\"EDT\":\"/Date(1671494400000-0500)/\",\"EDTLocalTime\":\"2022-12-19T19:00:00\",\"ETA\":\"/Date(1671494280000-0500)/\",\"ETALocalTime\":\"2022-12-19T18:58:00\",\"IsCompleted\":false,\"IsLastStopOnTrip\":false,\"LastUpdated\":\"/Date(1671440479140-0500)/\",\"LastUpdatedLocalTime\":\"2022-12-19T04:01:19\",\"Mode\":0,\"ModeReportLabel\":\"Normal\",\"PropogationStatus\":0,\"SDT\":\"/Date(1671494400000-0500)/\",\"SDTLocalTime\":\"2022-12-19T19:00:00\",\"STA\":\"/Date(1671494280000-0500)/\",\"STALocalTime\":\"2022-12-19T18:58:00\",\"StopFlag\":2,\"StopStatus\":0,\"StopStatusReportLabel\":\"Scheduled\",\"Trip\":{\"BlockFareboxId\":79,\"GtfsTripId\":\"t76C-b4F-sl4C\",\"InternalSignDesc\":\"Holyoke Transportation Ctr via Route 116\",\"InternetServiceDesc\":\"Holyoke Transportation Ctr via Route 116\",\"IVRServiceDesc\":\"Holyoke Transportation Ctr via Route 116\",\"StopSequence\":0,\"TripDirection\":\"S\",\"TripId\":1900,\"TripRecordId\":369430,\"TripStartTime\":\"/Date(-2208902400000-0500)/\",\"TripStartTimeLocalTime\":\"1900-01-01T19:00:00\",\"TripStatus\":0,\"TripStatusReportLabel\":\"Scheduled\"},\"PropertyName\":\"SATCO\"}],\"Direction\":\"Southbound\",\"DirectionCode\":\"S\",\"HeadwayDepartures\":null,\"IsDone\":false,\"IsHeadway\":false,\"IsHeadwayMonitored\":false,\"RouteId\":10029,\"RouteRecordId\":2101},{\"Departures\":[],\"Direction\":\"Northbound\",\"DirectionCode\":\"N\",\"HeadwayDepartures\":null,\"IsDone\":false,\"IsHeadway\":false,\"IsHeadwayMonitored\":false,\"RouteId\":20038,\"RouteRecordId\":595},{\"Departures\":[{\"ADT\":null,\"ADTLocalTime\":null,\"ATA\":null,\"ATALocalTime\":null,\"Bay\":null,\"Dev\":\"00:00:00\",\"EDT\":\"/Date(1671483600000-0500)/\",\"EDTLocalTime\":\"2022-12-19T16:00:00\",\"ETA\":\"/Date(1671483156000-0500)/\",\"ETALocalTime\":\"2022-12-19T15:52:36\",\"IsCompleted\":false,\"IsLastStopOnTrip\":false,\"LastUpdated\":\"/Date(1671482363843-0500)/\",\"LastUpdatedLocalTime\":\"2022-12-19T15:39:23\",\"Mode\":0,\"ModeReportLabel\":\"Normal\",\"PropogationStatus\":0,\"SDT\":\"/Date(1671483600000-0500)/\",\"SDTLocalTime\":\"2022-12-19T16:00:00\",\"STA\":\"/Date(1671483000000-0500)/\",\"STALocalTime\":\"2022-12-19T15:50:00\",\"StopFlag\":0,\"StopStatus\":0,\"StopStatusReportLabel\":\"Scheduled\",\"Trip\":{\"BlockFareboxId\":382,\"GtfsTripId\":\"t640-b17E-sl4A\",\"InternalSignDesc\":\"Mt Holyoke College via Hampshire College\",\"InternetServiceDesc\":\"Mt Holyoke College via Hampshire College\",\"IVRServiceDesc\":\"Mt Holyoke College via Hampshire College\",\"StopSequence\":0,\"TripDirection\":\"S\",\"TripId\":1600,\"TripRecordId\":261378,\"TripStartTime\":\"/Date(-2208913200000-0500)/\",\"TripStartTimeLocalTime\":\"1900-01-01T16:00:00\",\"TripStatus\":0,\"TripStatusReportLabel\":\"Scheduled\"},\"PropertyName\":\"UMASS\"},{\"ADT\":null,\"ADTLocalTime\":null,\"ATA\":null,\"ATALocalTime\":null,\"Bay\":null,\"Dev\":\"00:00:00\",\"EDT\":\"/Date(1671485400000-0500)/\",\"EDTLocalTime\":\"2022-12-19T16:30:00\",\"ETA\":\"/Date(1671484800000-0500)/\",\"ETALocalTime\":\"2022-12-19T16:20:00\",\"IsCompleted\":false,\"IsLastStopOnTrip\":false,\"LastUpdated\":\"/Date(1671482051400-0500)/\",\"LastUpdatedLocalTime\":\"2022-12-19T15:34:11\",\"Mode\":0,\"ModeReportLabel\":\"Normal\",\"PropogationStatus\":0,\"SDT\":\"/Date(1671485400000-0500)/\",\"SDTLocalTime\":\"2022-12-19T16:30:00\",\"STA\":\"/Date(1671484800000-0500)/\",\"STALocalTime\":\"2022-12-19T16:20:00\",\"StopFlag\":0,\"StopStatus\":0,\"StopStatusReportLabel\":\"Scheduled\",\"Trip\":{\"BlockFareboxId\":383,\"GtfsTripId\":\"t65E-b17F-sl4A\",\"InternalSignDesc\":\"Mt Holyoke College via Hampshire College\",\"InternetServiceDesc\":\"Mt Holyoke College via Hampshire College\",\"IVRServiceDesc\":\"Mt Holyoke College via Hampshire College\",\"StopSequence\":0,\"TripDirection\":\"S\",\"TripId\":1630,\"TripRecordId\":261382,\"TripStartTime\":\"/Date(-2208911400000-0500)/\",\"TripStartTimeLocalTime\":\"1900-01-01T16:30:00\",\"TripStatus\":0,\"TripStatusReportLabel\":\"Scheduled\"},\"PropertyName\":\"UMASS\"},{\"ADT\":null,\"ADTLocalTime\":null,\"ATA\":null,\"ATALocalTime\":null,\"Bay\":null,\"Dev\":\"00:00:00\",\"EDT\":\"/Date(1671487200000-0500)/\",\"EDTLocalTime\":\"2022-12-19T17:00:00\",\"ETA\":\"/Date(1671486600000-0500)/\",\"ETALocalTime\":\"2022-12-19T16:50:00\",\"IsCompleted\":false,\"IsLastStopOnTrip\":false,\"LastUpdated\":\"/Date(1671482226790-0500)/\",\"LastUpdatedLocalTime\":\"2022-12-19T15:37:06\",\"Mode\":0,\"ModeReportLabel\":\"Normal\",\"PropogationStatus\":0,\"SDT\":\"/Date(1671487200000-0500)/\",\"SDTLocalTime\":\"2022-12-19T17:00:00\",\"STA\":\"/Date(1671486600000-0500)/\",\"STALocalTime\":\"2022-12-19T16:50:00\",\"StopFlag\":0,\"StopStatus\":0,\"StopStatusReportLabel\":\"Scheduled\",\"Trip\":{\"BlockFareboxId\":381,\"GtfsTripId\":\"t6A4-b17D-sl4A\",\"InternalSignDesc\":\"Mt Holyoke College via Hampshire College\",\"InternetServiceDesc\":\"Mt Holyoke College via Hampshire College\",\"IVRServiceDesc\":\"Mt Holyoke College via Hampshire College\",\"StopSequence\":0,\"TripDirection\":\"S\",\"TripId\":1700,\"TripRecordId\":261387,\"TripStartTime\":\"/Date(-2208909600000-0500)/\",\"TripStartTimeLocalTime\":\"1900-01-01T17:00:00\",\"TripStatus\":0,\"TripStatusReportLabel\":\"Scheduled\"},\"PropertyName\":\"UMASS\"},{\"ADT\":null,\"ADTLocalTime\":null,\"ATA\":null,\"ATALocalTime\":null,\"Bay\":null,\"Dev\":\"00:00:00\",\"EDT\":\"/Date(1671489000000-0500)/\",\"EDTLocalTime\":\"2022-12-19T17:30:00\",\"ETA\":\"/Date(1671488400000-0500)/\",\"ETALocalTime\":\"2022-12-19T17:20:00\",\"IsCompleted\":false,\"IsLastStopOnTrip\":false,\"LastUpdated\":\"/Date(1671482363843-0500)/\",\"LastUpdatedLocalTime\":\"2022-12-19T15:39:23\",\"Mode\":0,\"ModeReportLabel\":\"Normal\",\"PropogationStatus\":0,\"SDT\":\"/Date(1671489000000-0500)/\",\"SDTLocalTime\":\"2022-12-19T17:30:00\",\"STA\":\"/Date(1671488400000-0500)/\",\"STALocalTime\":\"2022-12-19T17:20:00\",\"StopFlag\":0,\"StopStatus\":0,\"StopStatusReportLabel\":\"Scheduled\",\"Trip\":{\"BlockFareboxId\":382,\"GtfsTripId\":\"t6C2-b17E-sl4A\",\"InternalSignDesc\":\"Mt Holyoke College via Hampshire College\",\"InternetServiceDesc\":\"Mt Holyoke College via Hampshire College\",\"IVRServiceDesc\":\"Mt Holyoke College via Hampshire College\",\"StopSequence\":0,\"TripDirection\":\"S\",\"TripId\":1730,\"TripRecordId\":261390,\"TripStartTime\":\"/Date(-2208907800000-0500)/\",\"TripStartTimeLocalTime\":\"1900-01-01T17:30:00\",\"TripStatus\":0,\"TripStatusReportLabel\":\"Scheduled\"},\"PropertyName\":\"UMASS\"},{\"ADT\":null,\"ADTLocalTime\":null,\"ATA\":null,\"ATALocalTime\":null,\"Bay\":null,\"Dev\":\"00:00:00\",\"EDT\":\"/Date(1671490800000-0500)/\",\"EDTLocalTime\":\"2022-12-19T18:00:00\",\"ETA\":\"/Date(1671490200000-0500)/\",\"ETALocalTime\":\"2022-12-19T17:50:00\",\"IsCompleted\":false,\"IsLastStopOnTrip\":false,\"LastUpdated\":\"/Date(1671482051400-0500)/\",\"LastUpdatedLocalTime\":\"2022-12-19T15:34:11\",\"Mode\":0,\"ModeReportLabel\":\"Normal\",\"PropogationStatus\":0,\"SDT\":\"/Date(1671490800000-0500)/\",\"SDTLocalTime\":\"2022-12-19T18:00:00\",\"STA\":\"/Date(1671490200000-0500)/\",\"STALocalTime\":\"2022-12-19T17:50:00\",\"StopFlag\":0,\"StopStatus\":0,\"StopStatusReportLabel\":\"Scheduled\",\"Trip\":{\"BlockFareboxId\":383,\"GtfsTripId\":\"t708-b17F-sl4A\",\"InternalSignDesc\":\"Mt Holyoke College via Hampshire College\",\"InternetServiceDesc\":\"Mt Holyoke College via Hampshire College\",\"IVRServiceDesc\":\"Mt Holyoke College via Hampshire College\",\"StopSequence\":0,\"TripDirection\":\"S\",\"TripId\":1800,\"TripRecordId\":261394,\"TripStartTime\":\"/Date(-2208906000000-0500)/\",\"TripStartTimeLocalTime\":\"1900-01-01T18:00:00\",\"TripStatus\":0,\"TripStatusReportLabel\":\"Scheduled\"},\"PropertyName\":\"UMASS\"}],\"Direction\":\"Southbound\",\"DirectionCode\":\"S\",\"HeadwayDepartures\":null,\"IsDone\":false,\"IsHeadway\":false,\"IsHeadwayMonitored\":false,\"RouteId\":20038,\"RouteRecordId\":595},{\"Departures\":[{\"ADT\":null,\"ADTLocalTime\":null,\"ATA\":\"/Date(1671482349000-0500)/\",\"ATALocalTime\":\"2022-12-19T15:39:09\",\"Bay\":null,\"Dev\":\"00:04:24\",\"EDT\":\"/Date(1671482364000-0500)/\",\"EDTLocalTime\":\"2022-12-19T15:39:24\",\"ETA\":\"/Date(1671482349000-0500)/\",\"ETALocalTime\":\"2022-12-19T15:39:09\",\"IsCompleted\":false,\"IsLastStopOnTrip\":false,\"LastUpdated\":\"/Date(1671482366423-0500)/\",\"LastUpdatedLocalTime\":\"2022-12-19T15:39:26\",\"Mode\":0,\"ModeReportLabel\":\"Normal\",\"PropogationStatus\":0,\"SDT\":\"/Date(1671482100000-0500)/\",\"SDTLocalTime\":\"2022-12-19T15:35:00\",\"STA\":\"/Date(1671482100000-0500)/\",\"STALocalTime\":\"2022-12-19T15:35:00\",\"StopFlag\":0,\"StopStatus\":0,\"StopStatusReportLabel\":\"Scheduled\",\"Trip\":{\"BlockFareboxId\":4309,\"GtfsTripId\":\"t5DC-b10D5-slC\",\"InternalSignDesc\":\"Amherst College via UMass\",\"InternetServiceDesc\":\"Amherst College via UMass\",\"IVRServiceDesc\":\"Amherst College via UMass\",\"StopSequence\":2100,\"TripDirection\":\"E\",\"TripId\":1500,\"TripRecordId\":62192,\"TripStartTime\":\"/Date(-2208916800000-0500)/\",\"TripStartTimeLocalTime\":\"1900-01-01T15:00:00\",\"TripStatus\":0,\"TripStatusReportLabel\":\"Scheduled\"},\"PropertyName\":\"VATCO\"},{\"ADT\":null,\"ADTLocalTime\":null,\"ATA\":null,\"ATALocalTime\":null,\"Bay\":null,\"Dev\":\"00:02:28\",\"EDT\":\"/Date(1671483448000-0500)/\",\"EDTLocalTime\":\"2022-12-19T15:57:28\",\"ETA\":\"/Date(1671483448000-0500)/\",\"ETALocalTime\":\"2022-12-19T15:57:28\",\"IsCompleted\":false,\"IsLastStopOnTrip\":false,\"LastUpdated\":\"/Date(1671482358527-0500)/\",\"LastUpdatedLocalTime\":\"2022-12-19T15:39:18\",\"Mode\":0,\"ModeReportLabel\":\"Normal\",\"PropogationStatus\":0,\"SDT\":\"/Date(1671483300000-0500)/\",\"SDTLocalTime\":\"2022-12-19T15:55:00\",\"STA\":\"/Date(1671483300000-0500)/\",\"STALocalTime\":\"2022-12-19T15:55:00\",\"StopFlag\":0,\"StopStatus\":0,\"StopStatusReportLabel\":\"Scheduled\",\"Trip\":{\"BlockFareboxId\":4303,\"GtfsTripId\":\"t5F0-b10CF-slC\",\"InternalSignDesc\":\"Amherst College via UMass\",\"InternetServiceDesc\":\"Amherst College via UMass\",\"IVRServiceDesc\":\"Amherst College via UMass\",\"StopSequence\":2100,\"TripDirection\":\"E\",\"TripId\":1520,\"TripRecordId\":61607,\"TripStartTime\":\"/Date(-2208915600000-0500)/\",\"TripStartTimeLocalTime\":\"1900-01-01T15:20:00\",\"TripStatus\":0,\"TripStatusReportLabel\":\"Scheduled\"},\"PropertyName\":\"VATCO\"},{\"ADT\":null,\"ADTLocalTime\":null,\"ATA\":null,\"ATALocalTime\":null,\"Bay\":null,\"Dev\":\"00:00:00\",\"EDT\":\"/Date(1671484500000-0500)/\",\"EDTLocalTime\":\"2022-12-19T16:15:00\",\"ETA\":\"/Date(1671484500000-0500)/\",\"ETALocalTime\":\"2022-12-19T16:15:00\",\"IsCompleted\":false,\"IsLastStopOnTrip\":false,\"LastUpdated\":\"/Date(1671482247270-0500)/\",\"LastUpdatedLocalTime\":\"2022-12-19T15:37:27\",\"Mode\":0,\"ModeReportLabel\":\"Normal\",\"PropogationStatus\":0,\"SDT\":\"/Date(1671484500000-0500)/\",\"SDTLocalTime\":\"2022-12-19T16:15:00\",\"STA\":\"/Date(1671484500000-0500)/\",\"STALocalTime\":\"2022-12-19T16:15:00\",\"StopFlag\":0,\"StopStatus\":0,\"StopStatusReportLabel\":\"Scheduled\",\"Trip\":{\"BlockFareboxId\":4308,\"GtfsTripId\":\"t604-b10D4-slC\",\"InternalSignDesc\":\"Amherst College via UMass\",\"InternetServiceDesc\":\"Amherst College via UMass\",\"IVRServiceDesc\":\"Amherst College via UMass\",\"StopSequence\":2100,\"TripDirection\":\"E\",\"TripId\":1540,\"TripRecordId\":62135,\"TripStartTime\":\"/Date(-2208914400000-0500)/\",\"TripStartTimeLocalTime\":\"1900-01-01T15:40:00\",\"TripStatus\":0,\"TripStatusReportLabel\":\"Scheduled\"},\"PropertyName\":\"VATCO\"},{\"ADT\":null,\"ADTLocalTime\":null,\"ATA\":null,\"ATALocalTime\":null,\"Bay\":null,\"Dev\":\"00:00:00\",\"EDT\":\"/Date(1671485700000-0500)/\",\"EDTLocalTime\":\"2022-12-19T16:35:00\",\"ETA\":\"/Date(1671485700000-0500)/\",\"ETALocalTime\":\"2022-12-19T16:35:00\",\"IsCompleted\":false,\"IsLastStopOnTrip\":false,\"LastUpdated\":\"/Date(1671440405757-0500)/\",\"LastUpdatedLocalTime\":\"2022-12-19T04:00:05\",\"Mode\":0,\"ModeReportLabel\":\"Normal\",\"PropogationStatus\":0,\"SDT\":\"/Date(1671485700000-0500)/\",\"SDTLocalTime\":\"2022-12-19T16:35:00\",\"STA\":\"/Date(1671485700000-0500)/\",\"STALocalTime\":\"2022-12-19T16:35:00\",\"StopFlag\":0,\"StopStatus\":0,\"StopStatusReportLabel\":\"Scheduled\",\"Trip\":{\"BlockFareboxId\":4312,\"GtfsTripId\":\"t640-b10D8-slC\",\"InternalSignDesc\":\"Amherst College via UMass\",\"InternetServiceDesc\":\"Amherst College via UMass\",\"IVRServiceDesc\":\"Amherst College via UMass\",\"StopSequence\":2100,\"TripDirection\":\"E\",\"TripId\":1600,\"TripRecordId\":61641,\"TripStartTime\":\"/Date(-2208913200000-0500)/\",\"TripStartTimeLocalTime\":\"1900-01-01T16:00:00\",\"TripStatus\":0,\"TripStatusReportLabel\":\"Scheduled\"},\"PropertyName\":\"VATCO\"},{\"ADT\":null,\"ADTLocalTime\":null,\"ATA\":null,\"ATALocalTime\":null,\"Bay\":null,\"Dev\":\"00:00:00\",\"EDT\":\"/Date(1671486900000-0500)/\",\"EDTLocalTime\":\"2022-12-19T16:55:00\",\"ETA\":\"/Date(1671486900000-0500)/\",\"ETALocalTime\":\"2022-12-19T16:55:00\",\"IsCompleted\":false,\"IsLastStopOnTrip\":false,\"LastUpdated\":\"/Date(1671482363937-0500)/\",\"LastUpdatedLocalTime\":\"2022-12-19T15:39:23\",\"Mode\":0,\"ModeReportLabel\":\"Normal\",\"PropogationStatus\":0,\"SDT\":\"/Date(1671486900000-0500)/\",\"SDTLocalTime\":\"2022-12-19T16:55:00\",\"STA\":\"/Date(1671486900000-0500)/\",\"STALocalTime\":\"2022-12-19T16:55:00\",\"StopFlag\":0,\"StopStatus\":0,\"StopStatusReportLabel\":\"Scheduled\",\"Trip\":{\"BlockFareboxId\":4310,\"GtfsTripId\":\"t654-b10D6-slC\",\"InternalSignDesc\":\"Amherst College via UMass\",\"InternetServiceDesc\":\"Amherst College via UMass\",\"IVRServiceDesc\":\"Amherst College via UMass\",\"StopSequence\":2100,\"TripDirection\":\"E\",\"TripId\":1620,\"TripRecordId\":62217,\"TripStartTime\":\"/Date(-2208912000000-0500)/\",\"TripStartTimeLocalTime\":\"1900-01-01T16:20:00\",\"TripStatus\":0,\"TripStatusReportLabel\":\"Scheduled\"},\"PropertyName\":\"VATCO\"}],\"Direction\":\"East\",\"DirectionCode\":\"E\",\"HeadwayDepartures\":null,\"IsDone\":false,\"IsHeadway\":false,\"IsHeadwayMonitored\":false,\"RouteId\":30043,\"RouteRecordId\":295},{\"Departures\":[{\"ADT\":null,\"ADTLocalTime\":null,\"ATA\":null,\"ATALocalTime\":null,\"Bay\":null,\"Dev\":\"00:03:31\",\"EDT\":\"/Date(1671482911000-0500)/\",\"EDTLocalTime\":\"2022-12-19T15:48:31\",\"ETA\":\"/Date(1671482911000-0500)/\",\"ETALocalTime\":\"2022-12-19T15:48:31\",\"IsCompleted\":false,\"IsLastStopOnTrip\":false,\"LastUpdated\":\"/Date(1671482373340-0500)/\",\"LastUpdatedLocalTime\":\"2022-12-19T15:39:33\",\"Mode\":0,\"ModeReportLabel\":\"Normal\",\"PropogationStatus\":0,\"SDT\":\"/Date(1671482700000-0500)/\",\"SDTLocalTime\":\"2022-12-19T15:45:00\",\"STA\":\"/Date(1671482700000-0500)/\",\"STALocalTime\":\"2022-12-19T15:45:00\",\"StopFlag\":0,\"StopStatus\":0,\"StopStatusReportLabel\":\"Scheduled\",\"Trip\":{\"BlockFareboxId\":4304,\"GtfsTripId\":\"t5FA-b10D0-slC\",\"InternalSignDesc\":\"Northampton via Hampshire Mall\",\"InternetServiceDesc\":\"Northampton via Hampshire Mall\",\"IVRServiceDesc\":\"Northampton via Hampshire Mall\",\"StopSequence\":900,\"TripDirection\":\"W\",\"TripId\":1530,\"TripRecordId\":61950,\"TripStartTime\":\"/Date(-2208915000000-0500)/\",\"TripStartTimeLocalTime\":\"1900-01-01T15:30:00\",\"TripStatus\":0,\"TripStatusReportLabel\":\"Scheduled\"},\"PropertyName\":\"VATCO\"},{\"ADT\":null,\"ADTLocalTime\":null,\"ATA\":null,\"ATALocalTime\":null,\"Bay\":null,\"Dev\":\"00:02:24\",\"EDT\":\"/Date(1671484044000-0500)/\",\"EDTLocalTime\":\"2022-12-19T16:07:24\",\"ETA\":\"/Date(1671484044000-0500)/\",\"ETALocalTime\":\"2022-12-19T16:07:24\",\"IsCompleted\":false,\"IsLastStopOnTrip\":false,\"LastUpdated\":\"/Date(1671482366423-0500)/\",\"LastUpdatedLocalTime\":\"2022-12-19T15:39:26\",\"Mode\":0,\"ModeReportLabel\":\"Normal\",\"PropogationStatus\":0,\"SDT\":\"/Date(1671483900000-0500)/\",\"SDTLocalTime\":\"2022-12-19T16:05:00\",\"STA\":\"/Date(1671483900000-0500)/\",\"STALocalTime\":\"2022-12-19T16:05:00\",\"StopFlag\":0,\"StopStatus\":0,\"StopStatusReportLabel\":\"Scheduled\",\"Trip\":{\"BlockFareboxId\":4309,\"GtfsTripId\":\"t60E-b10D5-slC\",\"InternalSignDesc\":\"Northampton via Hampshire Mall\",\"InternetServiceDesc\":\"Northampton via Hampshire Mall\",\"IVRServiceDesc\":\"Northampton via Hampshire Mall\",\"StopSequence\":900,\"TripDirection\":\"W\",\"TripId\":1550,\"TripRecordId\":61684,\"TripStartTime\":\"/Date(-2208913800000-0500)/\",\"TripStartTimeLocalTime\":\"1900-01-01T15:50:00\",\"TripStatus\":0,\"TripStatusReportLabel\":\"Scheduled\"},\"PropertyName\":\"VATCO\"},{\"ADT\":null,\"ADTLocalTime\":null,\"ATA\":null,\"ATALocalTime\":null,\"Bay\":null,\"Dev\":\"00:00:28\",\"EDT\":\"/Date(1671484828000-0500)/\",\"EDTLocalTime\":\"2022-12-19T16:20:28\",\"ETA\":\"/Date(1671484828000-0500)/\",\"ETALocalTime\":\"2022-12-19T16:20:28\",\"IsCompleted\":false,\"IsLastStopOnTrip\":false,\"LastUpdated\":\"/Date(1671482358527-0500)/\",\"LastUpdatedLocalTime\":\"2022-12-19T15:39:18\",\"Mode\":0,\"ModeReportLabel\":\"Normal\",\"PropogationStatus\":0,\"SDT\":\"/Date(1671484800000-0500)/\",\"SDTLocalTime\":\"2022-12-19T16:20:00\",\"STA\":\"/Date(1671484800000-0500)/\",\"STALocalTime\":\"2022-12-19T16:20:00\",\"StopFlag\":0,\"StopStatus\":0,\"StopStatusReportLabel\":\"Scheduled\",\"Trip\":{\"BlockFareboxId\":4303,\"GtfsTripId\":\"t645-b10CF-slC\",\"InternalSignDesc\":\"Amherst College via UMass\",\"InternetServiceDesc\":\"Amherst College via UMass\",\"IVRServiceDesc\":\"Amherst College via UMass\",\"StopSequence\":900,\"TripDirection\":\"W\",\"TripId\":1605,\"TripRecordId\":61430,\"TripStartTime\":\"/Date(-2208912900000-0500)/\",\"TripStartTimeLocalTime\":\"1900-01-01T16:05:00\",\"TripStatus\":0,\"TripStatusReportLabel\":\"Scheduled\"},\"PropertyName\":\"VATCO\"},{\"ADT\":null,\"ADTLocalTime\":null,\"ATA\":null,\"ATALocalTime\":null,\"Bay\":null,\"Dev\":\"00:00:00\",\"EDT\":\"/Date(1671487200000-0500)/\",\"EDTLocalTime\":\"2022-12-19T17:00:00\",\"ETA\":\"/Date(1671487200000-0500)/\",\"ETALocalTime\":\"2022-12-19T17:00:00\",\"IsCompleted\":false,\"IsLastStopOnTrip\":false,\"LastUpdated\":\"/Date(1671440405757-0500)/\",\"LastUpdatedLocalTime\":\"2022-12-19T04:00:05\",\"Mode\":0,\"ModeReportLabel\":\"Normal\",\"PropogationStatus\":0,\"SDT\":\"/Date(1671487200000-0500)/\",\"SDTLocalTime\":\"2022-12-19T17:00:00\",\"STA\":\"/Date(1671487200000-0500)/\",\"STALocalTime\":\"2022-12-19T17:00:00\",\"StopFlag\":0,\"StopStatus\":0,\"StopStatusReportLabel\":\"Scheduled\",\"Trip\":{\"BlockFareboxId\":4312,\"GtfsTripId\":\"t66D-b10D8-slC\",\"InternalSignDesc\":\"Northampton via Hampshire Mall\",\"InternetServiceDesc\":\"Northampton via Hampshire Mall\",\"IVRServiceDesc\":\"Northampton via Hampshire Mall\",\"StopSequence\":900,\"TripDirection\":\"W\",\"TripId\":1645,\"TripRecordId\":62015,\"TripStartTime\":\"/Date(-2208910500000-0500)/\",\"TripStartTimeLocalTime\":\"1900-01-01T16:45:00\",\"TripStatus\":0,\"TripStatusReportLabel\":\"Scheduled\"},\"PropertyName\":\"VATCO\"},{\"ADT\":null,\"ADTLocalTime\":null,\"ATA\":null,\"ATALocalTime\":null,\"Bay\":null,\"Dev\":\"00:00:00\",\"EDT\":\"/Date(1671489600000-0500)/\",\"EDTLocalTime\":\"2022-12-19T17:40:00\",\"ETA\":\"/Date(1671489600000-0500)/\",\"ETALocalTime\":\"2022-12-19T17:40:00\",\"IsCompleted\":false,\"IsLastStopOnTrip\":false,\"LastUpdated\":\"/Date(1671482373340-0500)/\",\"LastUpdatedLocalTime\":\"2022-12-19T15:39:33\",\"Mode\":0,\"ModeReportLabel\":\"Normal\",\"PropogationStatus\":0,\"SDT\":\"/Date(1671489600000-0500)/\",\"SDTLocalTime\":\"2022-12-19T17:40:00\",\"STA\":\"/Date(1671489600000-0500)/\",\"STALocalTime\":\"2022-12-19T17:40:00\",\"StopFlag\":0,\"StopStatus\":0,\"StopStatusReportLabel\":\"Scheduled\",\"Trip\":{\"BlockFareboxId\":4304,\"GtfsTripId\":\"t6BD-b10D0-slC\",\"InternalSignDesc\":\"Northampton via Hampshire Mall\",\"InternetServiceDesc\":\"Northampton via Hampshire Mall\",\"IVRServiceDesc\":\"Northampton via Hampshire Mall\",\"StopSequence\":900,\"TripDirection\":\"W\",\"TripId\":1725,\"TripRecordId\":61968,\"TripStartTime\":\"/Date(-2208908100000-0500)/\",\"TripStartTimeLocalTime\":\"1900-01-01T17:25:00\",\"TripStatus\":0,\"TripStatusReportLabel\":\"Scheduled\"},\"PropertyName\":\"VATCO\"}],\"Direction\":\"West\",\"DirectionCode\":\"W\",\"HeadwayDepartures\":null,\"IsDone\":false,\"IsHeadway\":false,\"IsHeadwayMonitored\":false,\"RouteId\":30043,\"RouteRecordId\":295},{\"Departures\":[],\"Direction\":\"East\",\"DirectionCode\":\"E\",\"HeadwayDepartures\":null,\"IsDone\":true,\"IsHeadway\":false,\"IsHeadwayMonitored\":false,\"RouteId\":30943,\"RouteRecordId\":294},{\"Departures\":[{\"ADT\":null,\"ADTLocalTime\":null,\"ATA\":null,\"ATALocalTime\":null,\"Bay\":null,\"Dev\":\"00:00:00\",\"EDT\":\"/Date(1671486000000-0500)/\",\"EDTLocalTime\":\"2022-12-19T16:40:00\",\"ETA\":\"/Date(1671486000000-0500)/\",\"ETALocalTime\":\"2022-12-19T16:40:00\",\"IsCompleted\":false,\"IsLastStopOnTrip\":false,\"LastUpdated\":\"/Date(1671482247270-0500)/\",\"LastUpdatedLocalTime\":\"2022-12-19T15:37:27\",\"Mode\":0,\"ModeReportLabel\":\"Normal\",\"PropogationStatus\":0,\"SDT\":\"/Date(1671486000000-0500)/\",\"SDTLocalTime\":\"2022-12-19T16:40:00\",\"STA\":\"/Date(1671486000000-0500)/\",\"STALocalTime\":\"2022-12-19T16:40:00\",\"StopFlag\":0,\"StopStatus\":0,\"StopStatusReportLabel\":\"Scheduled\",\"Trip\":{\"BlockFareboxId\":4308,\"GtfsTripId\":\"t659-b10D4-slC\",\"InternalSignDesc\":\"Northampton via UMass Express\",\"InternetServiceDesc\":\"Northampton via UMass Express\",\"IVRServiceDesc\":\"Northampton via UMass Express\",\"StopSequence\":900,\"TripDirection\":\"W\",\"TripId\":1625,\"TripRecordId\":61340,\"TripStartTime\":\"/Date(-2208911700000-0500)/\",\"TripStartTimeLocalTime\":\"1900-01-01T16:25:00\",\"TripStatus\":0,\"TripStatusReportLabel\":\"Scheduled\"},\"PropertyName\":\"VATCO\"},{\"ADT\":null,\"ADTLocalTime\":null,\"ATA\":null,\"ATALocalTime\":null,\"Bay\":null,\"Dev\":\"00:00:00\",\"EDT\":\"/Date(1671488400000-0500)/\",\"EDTLocalTime\":\"2022-12-19T17:20:00\",\"ETA\":\"/Date(1671488400000-0500)/\",\"ETALocalTime\":\"2022-12-19T17:20:00\",\"IsCompleted\":false,\"IsLastStopOnTrip\":false,\"LastUpdated\":\"/Date(1671482363937-0500)/\",\"LastUpdatedLocalTime\":\"2022-12-19T15:39:23\",\"Mode\":0,\"ModeReportLabel\":\"Normal\",\"PropogationStatus\":0,\"SDT\":\"/Date(1671488400000-0500)/\",\"SDTLocalTime\":\"2022-12-19T17:20:00\",\"STA\":\"/Date(1671488400000-0500)/\",\"STALocalTime\":\"2022-12-19T17:20:00\",\"StopFlag\":0,\"StopStatus\":0,\"StopStatusReportLabel\":\"Scheduled\",\"Trip\":{\"BlockFareboxId\":4310,\"GtfsTripId\":\"t6A9-b10D6-slC\",\"InternalSignDesc\":\"Northampton via UMass Express\",\"InternetServiceDesc\":\"Northampton via UMass Express\",\"IVRServiceDesc\":\"Northampton via UMass Express\",\"StopSequence\":900,\"TripDirection\":\"W\",\"TripId\":1705,\"TripRecordId\":62000,\"TripStartTime\":\"/Date(-2208909300000-0500)/\",\"TripStartTimeLocalTime\":\"1900-01-01T17:05:00\",\"TripStatus\":0,\"TripStatusReportLabel\":\"Scheduled\"},\"PropertyName\":\"VATCO\"},{\"ADT\":null,\"ADTLocalTime\":null,\"ATA\":null,\"ATALocalTime\":null,\"Bay\":null,\"Dev\":\"00:00:00\",\"EDT\":\"/Date(1671490800000-0500)/\",\"EDTLocalTime\":\"2022-12-19T18:00:00\",\"ETA\":\"/Date(1671490800000-0500)/\",\"ETALocalTime\":\"2022-12-19T18:00:00\",\"IsCompleted\":false,\"IsLastStopOnTrip\":false,\"LastUpdated\":\"/Date(1671482366423-0500)/\",\"LastUpdatedLocalTime\":\"2022-12-19T15:39:26\",\"Mode\":0,\"ModeReportLabel\":\"Normal\",\"PropogationStatus\":0,\"SDT\":\"/Date(1671490800000-0500)/\",\"SDTLocalTime\":\"2022-12-19T18:00:00\",\"STA\":\"/Date(1671490800000-0500)/\",\"STALocalTime\":\"2022-12-19T18:00:00\",\"StopFlag\":2,\"StopStatus\":0,\"StopStatusReportLabel\":\"Scheduled\",\"Trip\":{\"BlockFareboxId\":4309,\"GtfsTripId\":\"t6D1-b10D5-slC\",\"InternalSignDesc\":\"Northampton via UMass Express\",\"InternetServiceDesc\":\"Northampton via UMass Express\",\"IVRServiceDesc\":\"Northampton via UMass Express\",\"StopSequence\":900,\"TripDirection\":\"W\",\"TripId\":1745,\"TripRecordId\":61754,\"TripStartTime\":\"/Date(-2208906900000-0500)/\",\"TripStartTimeLocalTime\":\"1900-01-01T17:45:00\",\"TripStatus\":0,\"TripStatusReportLabel\":\"Scheduled\"},\"PropertyName\":\"VATCO\"}],\"Direction\":\"West\",\"DirectionCode\":\"W\",\"HeadwayDepartures\":null,\"IsDone\":false,\"IsHeadway\":false,\"IsHeadwayMonitored\":false,\"RouteId\":30943,\"RouteRecordId\":294},{\"Departures\":[{\"ADT\":null,\"ADTLocalTime\":null,\"ATA\":null,\"ATALocalTime\":null,\"Bay\":null,\"Dev\":\"00:00:00\",\"EDT\":\"/Date(1671484200000-0500)/\",\"EDTLocalTime\":\"2022-12-19T16:10:00\",\"ETA\":\"/Date(1671484200000-0500)/\",\"ETALocalTime\":\"2022-12-19T16:10:00\",\"IsCompleted\":false,\"IsLastStopOnTrip\":false,\"LastUpdated\":\"/Date(1671445848243-0500)/\",\"LastUpdatedLocalTime\":\"2022-12-19T05:30:48\",\"Mode\":0,\"ModeReportLabel\":\"Normal\",\"PropogationStatus\":0,\"SDT\":\"/Date(1671484200000-0500)/\",\"SDTLocalTime\":\"2022-12-19T16:10:00\",\"STA\":\"/Date(1671484200000-0500)/\",\"STALocalTime\":\"2022-12-19T16:10:00\",\"StopFlag\":4,\"StopStatus\":0,\"StopStatusReportLabel\":\"Scheduled\",\"Trip\":{\"BlockFareboxId\":793,\"GtfsTripId\":\"t64A-b319-sl4A\",\"InternalSignDesc\":\"Worcester\",\"InternetServiceDesc\":\"Worcester\",\"IVRServiceDesc\":\"Worcester\",\"StopSequence\":0,\"TripDirection\":\"E\",\"TripId\":1610,\"TripRecordId\":261935,\"TripStartTime\":\"/Date(-2208912600000-0500)/\",\"TripStartTimeLocalTime\":\"1900-01-01T16:10:00\",\"TripStatus\":0,\"TripStatusReportLabel\":\"Scheduled\"},\"PropertyName\":\"UMASS\"}],\"Direction\":\"Eastbound\",\"DirectionCode\":\"E\",\"HeadwayDepartures\":null,\"IsDone\":false,\"IsHeadway\":false,\"IsHeadwayMonitored\":false,\"RouteId\":20079,\"RouteRecordId\":596},{\"Departures\":[],\"Direction\":\"Westbound\",\"DirectionCode\":\"W\",\"HeadwayDepartures\":null,\"IsDone\":false,\"IsHeadway\":false,\"IsHeadwayMonitored\":false,\"RouteId\":20079,\"RouteRecordId\":596}],\"StopId\":73,\"StopRecordId\":17223}]";

struct Routes route_38 = { "38", 20038, {0,0} };
struct Routes route_r29 = { "r29", 10029, {0,0} };
struct Routes route_b43 = { "b43", 30043, {0,0} };
struct Routes route_b43e = { "b43e", 30943, {0,0} };

struct Routes *routes[] = {&route_38, &route_r29, &route_b43, &route_b43e};

static void lte_init() {
  int err = 0;

	/* Init lte_lc*/
	err = lte_lc_init_and_connect();
	if (err) {
		LOG_ERR("Failed to init and connect. Err: %i", err);
  }
}

void main(void) {
  k_msleep(1000);
  lte_init();
  rtc_init();
  set_rtc_time();

  // LOG_INF("UTC Unix Epoc: %lld", get_rtc_time());
  
  // TODO: Create seperate thread for time sync
  // while(true) {
  //   k_sleep(K_MINUTES(50));
  //   set_rtc_time();
  // }

  // while(true) {
  //   k_msleep(5000);
  //   LOG_INF("UTC Unix Epoc: %lld", get_rtc_time());
  // }
  
  get_departures(http_get_request());
  LOG_INF("Route 38 EDT: [North: %d, South: %d]", route_38.etd[0], route_38.etd[1]);
  LOG_INF("Route R29 EDT: [North: %d, South: %d]", route_r29.etd[0], route_r29.etd[1]);
  LOG_INF("Route B43 EDT: [East: %d, West: %d]", route_b43.etd[0], route_b43.etd[1]);
  LOG_INF("Route B43E EDT: [East: %d, West: %d]", route_b43e.etd[0], route_b43e.etd[1]);
}

  //printk("\n%s", http_get_request());
  
  // // Bind i2c
	// i2c_dev = device_get_binding(MY_I2C);
	// if (i2c_dev == NULL) {
	// 	printk("Can't bind I2C device %s\n", MY_I2C);
	// 	return;
	// }

	// // Write to i2c
	// uint8_t i2c_addr = 0x41;
  // unsigned char i2c_tx_buffer[] = {'3', '0'};
  // i2c_write(i2c_dev, &i2c_tx_buffer, sizeof(i2c_tx_buffer), i2c_addr);