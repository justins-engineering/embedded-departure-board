# Hardening
CONFIG_STACK_SENTINEL=n
CONFIG_HW_STACK_PROTECTION=y
CONFIG_MPU_STACK_GUARD=y

# External SPI Flash
CONFIG_NVS=y
CONFIG_SETTINGS_NVS=y
CONFIG_PM_EXTERNAL_FLASH_BASE=0x0
CONFIG_SPI_NOR=y
CONFIG_SPI_NOR_FLASH_LAYOUT_PAGE_SIZE=4096
CONFIG_PM_EXTERNAL_FLASH_MCUBOOT_SECONDARY=y
CONFIG_PM_OVERRIDE_EXTERNAL_DRIVER_CHECK=y

# Allow writing to the flash at runtime
CONFIG_MPU_ALLOW_FLASH_WRITE=y

# Neopixels over SPI
CONFIG_SPI=y
CONFIG_LED_STRIP=y

# NRF Modem configurations
CONFIG_NRF_MODEM_LIB=y
CONFIG_NRF_MODEM_LIB_FAULT_STRERROR=y
CONFIG_NRF_MODEM_LIB_ON_FAULT_APPLICATION_SPECIFIC=y
CONFIG_MODEM_KEY_MGMT=n
CONFIG_PDN=y

# Align the max FD entry to NRF_MODEM_MAX_SOCKET_COUNT(8)
CONFIG_ZVFS_OPEN_MAX=8
CONFIG_NET_SOCKETS_POLL_MAX=8

# NRF LTE link control library
CONFIG_LTE_LINK_CONTROL=y

# LTE Power Saving Mode
CONFIG_LTE_LC_PSM_MODULE=y
CONFIG_LTE_PSM_REQ=y
# Request periodic TAU of 12 hours
CONFIG_LTE_PSM_REQ_RPTAU="00101100"
# Set Requested Active Time (RAT) to 10 seconds.
CONFIG_LTE_PSM_REQ_RAT="00000101"

# NRF net configurations
CONFIG_NET_NATIVE=n
CONFIG_NET_SOCKETS_OFFLOAD=y
CONFIG_NET_SOCKETS_SOCKOPT_TLS=y
# Disable Duplicate Address Detection (DAD), not properly implemented for offloaded interfaces
CONFIG_NET_IPV6_NBR_CACHE=n
CONFIG_NET_IPV6_MLD=n

# TFM configurations
CONFIG_BUILD_WITH_TFM=y
CONFIG_TFM_PROFILE_TYPE_NOT_SET=y
CONFIG_TFM_CMAKE_BUILD_TYPE_RELEASE=y

# TFM logging requirements
CONFIG_TFM_SECURE_UART0=y
CONFIG_TFM_SECURE_UART_SHARE_INSTANCE=y

# Crypto drivers
CONFIG_NRF_SECURITY=y
CONFIG_NORDIC_SECURITY_BACKEND=y
CONFIG_PSA_CRYPTO_DRIVER_CC3XX=y

# MbedTLS configurations
CONFIG_MBEDTLS=y
CONFIG_MBEDTLS_ENABLE_HEAP=y
CONFIG_MBEDTLS_HEAP_SIZE=32768
CONFIG_MBEDTLS_SSL_IN_CONTENT_LEN=4096
CONFIG_MBEDTLS_SSL_OUT_CONTENT_LEN=4096

# Create the mbed SSL/TLS library in addition to the mbed crypto library
CONFIG_MBEDTLS_TLS_LIBRARY=y

# mbedtls X509 configurations
CONFIG_MBEDTLS_X509_LIBRARY=y

# Enable TLS credentials management subsystem
CONFIG_TLS_CREDENTIALS=y

# PSA options
CONFIG_MBEDTLS_PSA_CRYPTO_C=y
CONFIG_MBEDTLS_RSA_C=y

# Key type configurations
CONFIG_PSA_WANT_KEY_TYPE_AES=y
CONFIG_PSA_WANT_KEY_TYPE_ECC_PUBLIC_KEY=y
CONFIG_PSA_WANT_KEY_TYPE_RSA_PUBLIC_KEY=y

# Select RSA key sizes
CONFIG_PSA_WANT_RSA_KEY_SIZE_1024=y
CONFIG_PSA_WANT_RSA_KEY_SIZE_2048=y
CONFIG_PSA_WANT_RSA_KEY_SIZE_4096=y

# PSA algorithms
CONFIG_PSA_WANT_ALG_GCM=y
CONFIG_PSA_WANT_ALG_ECDH=y
CONFIG_PSA_WANT_ALG_ECDSA=y
CONFIG_PSA_WANT_ECC_MONTGOMERY_255=y
CONFIG_PSA_WANT_ALG_RSA_PKCS1V15_CRYPT=y
CONFIG_PSA_WANT_ALG_RSA_PKCS1V15_SIGN=y

# Increase MPI size to 512 for 4096B certificates
CONFIG_MBEDTLS_MPI_MAX_SIZE=512

# Enable SNI
CONFIG_MBEDTLS_X509_CRT_PARSE_C=y
CONFIG_MBEDTLS_SSL_SERVER_NAME_INDICATION=y

# Enable SSL cache
CONFIG_MBEDTLS_SSL_CACHE_C=y

# Enable SSL session tickets
CONFIG_MBEDTLS_SSL_SESSION_TICKETS=y

# Enable Mbed TLS logs
# CONFIG_MBEDTLS_DEBUG=y
# CONFIG_MBEDTLS_DEBUG_C=y
# CONFIG_MBEDTLS_DEBUG_LEVEL=4
# CONFIG_MBEDTLS_LOG_LEVEL_DBG=y
# CONFIG_MBEDTLS_SSL_DEBUG_ALL=y

# Debugging
# CONFIG_TLS_CREDENTIALS_LOG_LEVEL_DBG=y
# CONFIG_NRF_MODEM_LIB_NET_IF_LOG_LEVEL_DBG=y
# CONFIG_NRF_MODEM_LIB_LOG_LEVEL_DBG=y
# CONFIG_NRF_MODEM_LIB_MEM_DIAG=y
# CONFIG_LTE_LINK_CONTROL_LOG_LEVEL_DBG=y
# CONFIG_NVS_LOG_LEVEL_DBG=y
# CONFIG_NRF_MODEM_LIB_MEM_DIAG_ALLOC=n
